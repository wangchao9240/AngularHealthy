angular.module("me-lazyload",[]).directive("lazySrc",["$window","$document",function(e,t){function n(e){var t=e.data("__uid");return t||e.data("__uid",t=""+ ++d),t}function a(){var e,t="number"==typeof f.pageXOffset?f.pageXOffset:(((e=c.documentElement)||(e=l.parentNode))&&"number"==typeof e.scrollLeft?e:l).scrollLeft,n="number"==typeof f.pageYOffset?f.pageYOffset:(((e=c.documentElement)||(e=l.parentNode))&&"number"==typeof e.scrollTop?e:l).scrollTop;return{offsetX:t,offsetY:n}}function i(e){var t,n,i=e[0],o=i.getBoundingClientRect(),r=a(),l=r.offsetX,s=r.offsetY,d=o.width||i.width,u=o.height||i.height,p=o.left+l,m=o.top+s,y=Math.max(c.documentElement.clientWidth,f.innerWidth||0),h=Math.max(c.documentElement.clientHeight,f.innerHeight||0);return m<=s?m+u>=s&&(n=!0):m>=s&&m<=s+h&&(n=!0),p<=l?p+d>=l&&(t=!0):p>=l&&p<=l+y&&(t=!0),t&&n}function o(){angular.forEach(u,function(e,t){var n=e.iElement,a=e.$scope;i(n)&&n.attr("src",a.lazySrc)})}function r(){var e=angular.element(this),t=n(e);e.css("opacity",1),u.hasOwnProperty(t)&&delete u[t]}var c=t[0],l=c.body,f=e,s=angular.element(f),d=0,u={};return s.bind("scroll",o),s.bind("resize",o),{restrict:"A",scope:{lazySrc:"@",animateVisible:"@",animateSpeed:"@"},link:function(e,t){t.bind("load",r),e.$watch("lazySrc",function(){var a="1s";if(null!=e.animateSpeed&&(a=e.animateSpeed),i(t))e.animateVisible&&t.css({"background-color":"#fff",opacity:0,"-webkit-transition":"opacity "+a,transition:"opacity "+a}),t.attr("src",e.lazySrc);else{var o=n(t);t.css({"background-color":"#fff",opacity:0,"-webkit-transition":"opacity "+a,transition:"opacity "+a}),u[o]={iElement:t,$scope:e}}}),e.$on("$destroy",function(){t.unbind("load");var e=n(t);u.hasOwnProperty(e)&&delete u[e]})}}}]);